<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>OpenDots</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
    <link rel="stylesheet" href="app/src/styles/style.css" />
</head>

<body>
    <div class="header">
        <div class="headerIcons">
            <div class="headerIcon" id="burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <img src="app/resrc/user.png" alt="Logo" class="headerIcon" id="user">
        </div>
        <p>●.◦ OpenDots</p>
    </div>
    <section data-include="app/src/pages/configure.html"></section>

    <script>
        async function loadComponents() {
            const elements = document.querySelectorAll("[data-include]");

            // Detect if running on GitHub Pages or locally
            const pathParts = window.location.pathname.split("/");
            const isLocal = window.location.hostname === "127.0.0.1" || window.location.hostname === "localhost";
            const base = isLocal
                ? "" // local → no repo prefix
                : `/${pathParts[1]}/`; // GitHub Pages → "/OpenDots/"

            for (const el of elements) {
                const file = el.getAttribute("data-include");
                const filePath = base + file.replace(/^\/+/, ""); // remove any extra "/"

                try {
                    const res = await fetch(filePath);
                    if (!res.ok) throw new Error(`Failed to load ${filePath}`);
                    const html = await res.text();
                    el.innerHTML = html;

                    // Re-run any scripts inside loaded HTML
                    const scripts = el.querySelectorAll("script");
                    scripts.forEach(oldScript => {
                        const newScript = document.createElement("script");
                        if (oldScript.src) {
                            const src = oldScript.getAttribute("src");
                            newScript.src = src.startsWith("http")
                                ? src
                                : base + src.replace(/^\/+/, "");
                        } else {
                            newScript.textContent = oldScript.textContent;
                        }
                        [...oldScript.attributes].forEach(attr =>
                            newScript.setAttribute(attr.name, attr.value)
                        );
                        oldScript.replaceWith(newScript);
                    });
                } catch (err) {
                    el.innerHTML = `<p style="color:red;">Error loading ${filePath}</p>`;
                    console.error(err);
                }
            }
        }

        document.addEventListener("DOMContentLoaded", loadComponents);
    </script>

</body>

</html>